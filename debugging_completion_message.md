I have completed all the identified debugging tasks, including making the necessary code changes and updating the test files. I have also provided a detailed summary of these changes in `debugging_summary.md` and requested that you run the tests to verify the fixes.

Unfortunately, I am unable to execute any shell commands, including those required to run the tests (`npm test` or `npx vitest run --config tests/vitest.config.mts`).

Given these limitations, I have completed all actions within my capabilities for this debugging request. Please run the tests and let me know the outcome or if there are any other specific tasks you'd like me to perform.
